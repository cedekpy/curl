<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curl - Platforma komunikacyjna</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }

        :root {
            --primary-color: #5865f2;
            --secondary-color: #404eed;
            --dark-bg: #36393f;
            --darker-bg: #2f3136;
            --sidebar-bg: #202225;
            --text-color: #dcddde;
            --text-muted: #72767d;
            --online-status: #3ba55d;
            --idle-status: #faa81a;
            --dnd-status: #ed4245;
            --border-color: #202225;
            --message-hover: #32353b;
            --input-bg: #40444b;
            --success-color: #3ba55d;
            --error-color: #ed4245;
            --warning-color: #faa81a;
            --owner-color: #faa81a;
            --admin-color: #ed4245;
            --mod-color: #5865f2;
        }

        body {
            display: flex;
            height: 100vh;
            background-color: var(--dark-bg);
            color: var(--text-color);
            overflow: hidden;
        }

        /* Stylizacja paska bocznego z serwerami */
        .servers-sidebar {
            width: 72px;
            background-color: var(--sidebar-bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 0;
            overflow-y: auto;
        }

        .server-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: var(--darker-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            cursor: pointer;
            transition: border-radius 0.2s, background-color 0.2s;
            font-weight: bold;
            color: white;
            position: relative;
        }

        .server-icon:hover {
            border-radius: 16px;
            background-color: var(--primary-color);
        }

        .server-icon.active {
            border-radius: 16px;
            background-color: var(--primary-color);
        }

        .server-icon.add-server {
            background-color: #36393f;
            color: var(--success-color);
            font-size: 24px;
        }

        .server-icon.curlio {
            background-color: var(--primary-color);
            color: white;
            font-size: 18px;
        }

        .server-indicator {
            position: absolute;
            left: -4px;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 0;
            background-color: white;
            border-radius: 0 4px 4px 0;
            transition: height 0.2s;
        }

        .server-icon.active .server-indicator {
            height: 20px;
        }

        .divider {
            width: 32px;
            height: 2px;
            background-color: #2e3338;
            margin: 8px 0;
        }

        /* Stylizacja g≈Ç√≥wnej czƒô≈õci */
        .main-container {
            display: flex;
            flex: 1;
        }

        /* Stylizacja panelu znajomych/kana≈Ç√≥w */
        .channels-sidebar {
            width: 240px;
            background-color: var(--darker-bg);
            display: flex;
            flex-direction: column;
        }

        .server-header {
            padding: 16px;
            border-bottom: 2px solid var(--border-color);
            font-weight: 600;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }

        .server-header:hover {
            background-color: rgba(79, 84, 92, 0.16);
        }

        .server-dropdown {
            position: absolute;
            top: 50px;
            left: 240px;
            background-color: var(--darker-bg);
            border-radius: 8px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            width: 200px;
            z-index: 1000;
            display: none;
        }

        .server-dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .server-dropdown-item:hover {
            background-color: rgba(79, 84, 92, 0.16);
        }

        .server-dropdown-item.delete {
            color: var(--error-color);
        }

        .channels-list {
            padding: 16px;
            flex: 1;
            overflow-y: auto;
        }

        .channel-category {
            margin-bottom: 20px;
        }

        .category-title {
            color: var(--text-muted);
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .add-channel-btn {
            cursor: pointer;
            color: var(--text-muted);
            padding: 2px;
            border-radius: 4px;
        }

        .add-channel-btn:hover {
            color: var(--text-color);
            background-color: rgba(79, 84, 92, 0.16);
        }

        .channel-item {
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            margin-bottom: 2px;
            color: var(--text-muted);
            position: relative;
        }

        .channel-item:hover {
            background-color: rgba(79, 84, 92, 0.16);
            color: var(--text-color);
        }

        .channel-item.active {
            background-color: rgba(79, 84, 92, 0.6);
            color: var(--text-color);
        }

        .channel-icon {
            margin-right: 8px;
            font-size: 14px;
        }

        .channel-settings {
            position: absolute;
            right: 8px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .channel-item:hover .channel-settings {
            opacity: 1;
        }

        /* Stylizacja znajomych */
        .friends-list {
            padding: 16px;
            flex: 1;
            overflow-y: auto;
        }

        .friend-item {
            display: flex;
            align-items: center;
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 4px;
            cursor: pointer;
            position: relative;
        }

        .friend-item:hover {
            background-color: rgba(79, 84, 92, 0.16);
        }

        .friend-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #5865f2;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
            position: relative;
        }

        .status-indicator {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            bottom: 0;
            right: 0;
            border: 2px solid var(--darker-bg);
        }

        .status-online {
            background-color: var(--online-status);
        }

        .status-idle {
            background-color: var(--idle-status);
        }

        .status-dnd {
            background-color: var(--dnd-status);
        }

        .status-offline {
            background-color: var(--text-muted);
        }

        .friend-info {
            flex: 1;
        }

        .friend-name {
            font-weight: 500;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .friend-badge {
            font-size: 10px;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: bold;
        }

        .badge-owner {
            background-color: var(--owner-color);
            color: #000;
        }

        .badge-admin {
            background-color: var(--admin-color);
            color: white;
        }

        .badge-mod {
            background-color: var(--mod-color);
            color: white;
        }

        .friend-status {
            font-size: 12px;
            color: var(--text-muted);
        }

        .friend-actions {
            opacity: 0;
            transition: opacity 0.2s;
            display: flex;
            gap: 4px;
        }

        .friend-item:hover .friend-actions {
            opacity: 1;
        }

        /* Stylizacja obszaru czatu */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--dark-bg);
        }

        .chat-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            z-index: 1;
        }

        .chat-header-icon {
            margin-right: 8px;
            color: var(--text-muted);
        }

        .chat-header-title {
            font-weight: 600;
            font-size: 16px;
        }

        .chat-header-topic {
            margin-left: 8px;
            font-size: 14px;
            color: var(--text-muted);
        }

        .messages-container {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .message {
            display: flex;
            margin-bottom: 20px;
            padding: 2px 16px;
            border-radius: 4px;
            position: relative;
        }

        .message:hover {
            background-color: var(--message-hover);
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #5865f2;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 16px;
            flex-shrink: 0;
            cursor: pointer;
            position: relative;
        }

        .message-avatar:hover::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.3);
        }

        .message-content {
            flex: 1;
        }

        .message-header {
            display: flex;
            align-items: baseline;
            margin-bottom: 8px;
        }

        .message-author {
            font-weight: 600;
            font-size: 16px;
            margin-right: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .message-time {
            font-size: 12px;
            color: var(--text-muted);
        }

        .message-text {
            font-size: 15px;
            line-height: 1.4;
        }

        .message-actions {
            position: absolute;
            right: 16px;
            top: 8px;
            background-color: var(--darker-bg);
            border-radius: 4px;
            display: flex;
            gap: 4px;
            padding: 4px;
            opacity: 0;
            transition: opacity 0.2s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .message-action-btn {
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            background-color: transparent;
            border: none;
            color: var(--text-muted);
        }

        .message-action-btn:hover {
            background-color: rgba(79, 84, 92, 0.16);
            color: var(--text-color);
        }

        /* Stylizacja pola tekstowego */
        .message-input-container {
            padding: 16px;
            background-color: var(--dark-bg);
        }

        .message-input-wrapper {
            display: flex;
            align-items: center;
            background-color: var(--input-bg);
            border-radius: 8px;
            padding: 0 12px;
            position: relative;
        }

        .emoji-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 8px;
            font-size: 18px;
        }

        .emoji-btn:hover {
            color: var(--text-color);
        }

        .message-input {
            flex: 1;
            background-color: transparent;
            border: none;
            padding: 12px;
            color: var(--text-color);
            font-size: 15px;
            resize: none;
            outline: none;
            min-height: 20px;
            max-height: 200px;
        }

        .message-input::placeholder {
            color: var(--text-muted);
        }

        .send-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
            margin-left: 8px;
        }

        .send-button:hover {
            background-color: var(--secondary-color);
        }

        .send-button:disabled {
            background-color: var(--text-muted);
            cursor: not-allowed;
        }

        /* Stylizacja panelu u≈ºytkownik√≥w */
        .users-sidebar {
            width: 240px;
            background-color: var(--darker-bg);
            padding: 16px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .users-title {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .user-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 4px;
            border-radius: 4px;
            position: relative;
        }

        .user-item:hover {
            background-color: rgba(79, 84, 92, 0.16);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #ed4245;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
            position: relative;
            flex-shrink: 0;
        }

        .user-info {
            flex: 1;
            overflow: hidden;
        }

        .user-name {
            font-weight: 500;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .user-tag {
            font-size: 12px;
            color: var(--text-muted);
        }

        .user-activity {
            font-size: 12px;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Stylizacja profilu u≈ºytkownika */
        .user-profile {
            display: flex;
            align-items: center;
            padding: 8px;
            background-color: #292b2f;
            border-top: 1px solid var(--border-color);
            margin-top: auto;
            position: relative;
        }

        .profile-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #5865f2;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 8px;
            position: relative;
            cursor: pointer;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .profile-tag {
            font-size: 12px;
            color: var(--text-muted);
        }

        .profile-controls {
            display: flex;
            gap: 8px;
        }

        .profile-controls i {
            padding: 6px;
            border-radius: 4px;
            cursor: pointer;
            color: var(--text-muted);
        }

        .profile-controls i:hover {
            background-color: rgba(79, 84, 92, 0.16);
            color: var(--text-color);
        }

        /* Stylizacja ekranu logowania */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .login-container {
            background-color: var(--dark-bg);
            width: 480px;
            border-radius: 8px;
            padding: 32px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .login-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .login-logo {
            font-size: 28px;
            font-weight: 700;
            color: white;
            margin-bottom: 8px;
        }

        .login-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .login-subtitle {
            color: var(--text-muted);
            font-size: 14px;
        }

        .login-buttons {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 24px;
        }

        .login-button {
            padding: 12px;
            border-radius: 4px;
            border: none;
            font-weight: 500;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }

        .login-button.google {
            background-color: #ffffff;
            color: #333;
        }

        .login-button.google:hover {
            background-color: #f0f0f0;
        }

        .login-button.discord {
            background-color: #5865f2;
            color: white;
        }

        .login-button.discord:hover {
            background-color: #4752c4;
        }

        .login-button i {
            margin-right: 8px;
            font-size: 18px;
        }

        .login-footer {
            text-align: center;
            font-size: 14px;
            color: var(--text-muted);
        }

        .login-footer a {
            color: #00aff4;
            text-decoration: none;
        }

        .login-footer a:hover {
            text-decoration: underline;
        }

        /* Stylizacja modali */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            display: none;
        }

        .modal {
            background-color: var(--dark-bg);
            border-radius: 8px;
            padding: 24px;
            width: 440px;
            max-width: 90vw;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .modal-subtitle {
            color: var(--text-muted);
            font-size: 14px;
        }

        .modal-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 16px;
            background-color: var(--input-bg);
            border: 1px solid transparent;
            border-radius: 4px;
            color: var(--text-color);
            font-size: 14px;
        }

        .modal-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 20px;
        }

        .modal-btn {
            padding: 10px 16px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
        }

        .modal-btn.primary {
            background-color: var(--primary-color);
            color: white;
        }

        .modal-btn.secondary {
            background-color: var(--darker-bg);
            color: var(--text-color);
        }

        .modal-btn.danger {
            background-color: var(--error-color);
            color: white;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 4px;
            font-weight: 500;
            z-index: 1002;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: slideIn 0.3s ease-out;
            max-width: 400px;
        }

        .notification.success {
            background-color: var(--success-color);
            color: white;
        }

        .notification.error {
            background-color: var(--error-color);
            color: white;
        }

        .notification.info {
            background-color: var(--primary-color);
            color: white;
        }

        .notification.warning {
            background-color: var(--warning-color);
            color: black;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .hidden {
            display: none !important;
        }

        /* Emoji picker */
        .emoji-picker {
            position: absolute;
            bottom: 70px;
            left: 16px;
            background-color: var(--darker-bg);
            border-radius: 8px;
            padding: 12px;
            width: 300px;
            max-height: 300px;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: none;
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
        }

        .emoji-item {
            font-size: 20px;
            padding: 8px;
            cursor: pointer;
            text-align: center;
            border-radius: 4px;
        }

        .emoji-item:hover {
            background-color: rgba(79, 84, 92, 0.16);
        }

        /* Context menu */
        .context-menu {
            position: fixed;
            background-color: var(--darker-bg);
            border-radius: 8px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            min-width: 200px;
            display: none;
        }

        .context-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        .context-menu-item:hover {
            background-color: rgba(79, 84, 92, 0.16);
        }

        .context-menu-item.delete {
            color: var(--error-color);
        }

        /* Stylizacja responsywno≈õci */
        @media (max-width: 1200px) {
            .users-sidebar {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .channels-sidebar {
                display: none;
            }
            
            .servers-sidebar {
                width: 60px;
            }
        }

        /* Stylizacja scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #202225;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #2e3338;
        }
    </style>
</head>
<body>
    <!-- Ekran logowania -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">Curl</div>
                <h2 class="login-title">Witaj w Curl!</h2>
                <p class="login-subtitle">Zaloguj siƒô, aby kontynuowaƒá</p>
            </div>
            <div class="login-buttons">
                <button class="login-button google" id="googleLoginBtn">
                    <i class="fab fa-google"></i> Zaloguj przez Google
                </button>
                <button class="login-button discord" id="discordLoginBtn">
                    <i class="fab fa-discord"></i> Zaloguj przez Discord
                </button>
            </div>
            <div class="login-footer">
                <p>LogujƒÖc siƒô, akceptujesz <a href="#">Warunki korzystania z us≈Çugi</a> i <a href="#">Politykƒô prywatno≈õci</a>.</p>
            </div>
        </div>
    </div>

    <!-- Notification area -->
    <div id="notificationArea"></div>

    <!-- Panel serwer√≥w -->
    <div class="servers-sidebar hidden" id="serversSidebar">
        <div class="server-icon curlio active" title="Curlio" data-server-id="main">
            C
            <div class="server-indicator"></div>
        </div>
        <div class="divider"></div>
        <!-- Serwery bƒôdƒÖ ≈Çadowane dynamicznie -->
        <div class="server-icon add-server" title="Dodaj serwer" id="addServerBtn">
            <i class="fas fa-plus"></i>
        </div>
    </div>

    <!-- G≈Ç√≥wna czƒô≈õƒá aplikacji -->
    <div class="main-container hidden" id="mainContainer">
        <!-- Panel kana≈Ç√≥w/znajomych -->
        <div class="channels-sidebar">
            <div class="server-header" id="serverHeader">
                <span id="currentServerName">G≈Ç√≥wny serwer</span>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="server-dropdown" id="serverDropdown">
                <div class="server-dropdown-item" id="serverSettingsBtn">
                    <i class="fas fa-cog"></i>
                    <span>Ustawienia serwera</span>
                </div>
                <div class="server-dropdown-item" id="createChannelBtn">
                    <i class="fas fa-plus"></i>
                    <span>Stw√≥rz kana≈Ç</span>
                </div>
                <div class="server-dropdown-item delete" id="deleteServerBtn">
                    <i class="fas fa-trash"></i>
                    <span>Usu≈Ñ serwer</span>
                </div>
            </div>
            <div class="channels-list">
                <div class="channel-category">
                    <div class="category-title">
                        <span>KANA≈ÅY TEKSTOWE</span>
                        <i class="fas fa-plus add-channel-btn" id="addChannelBtn"></i>
                    </div>
                    <div class="channel-list" id="channelList">
                        <!-- Kana≈Çy bƒôdƒÖ ≈Çadowane dynamicznie -->
                    </div>
                </div>
                
                <div class="channel-category">
                    <div class="category-title">
                        <span>CZ≈ÅONKOWIE ‚Äî <span id="onlineCount">0</span></span>
                    </div>
                    <div class="friends-list" id="friendsList">
                        <!-- Cz≈Çonkowie serwera bƒôdƒÖ ≈Çadowani dynamicznie -->
                    </div>
                </div>
            </div>
            
            <!-- Profil u≈ºytkownika -->
            <div class="user-profile" id="userProfile">
                <div class="profile-avatar" id="userAvatar">
                    <span>?</span>
                </div>
                <div class="profile-info">
                    <div class="profile-name" id="userName">
                        <span>≈Åadowanie...</span>
                        <span class="friend-badge" id="userBadge"></span>
                    </div>
                    <div class="profile-tag" id="userTag">#0000</div>
                </div>
                <div class="profile-controls">
                    <i class="fas fa-microphone"></i>
                    <i class="fas fa-headphones"></i>
                    <i class="fas fa-cog" id="userSettingsBtn"></i>
                </div>
            </div>
        </div>

        <!-- Obszar czatu -->
        <div class="chat-area">
            <div class="chat-header">
                <i class="fas fa-hashtag chat-header-icon"></i>
                <span class="chat-header-title" id="currentChannelName">og√≥lny</span>
                <span class="chat-header-topic" id="channelTopic">‚Ä¢ Wybierz kana≈Ç</span>
            </div>
            
            <div class="messages-container" id="messagesContainer">
                <!-- Wiadomo≈õci bƒôdƒÖ ≈Çadowane dynamicznie -->
            </div>
            
            <div class="message-input-container">
                <div class="message-input-wrapper">
                    <button class="emoji-btn" id="emojiBtn">üòÄ</button>
                    <div class="emoji-picker" id="emojiPicker">
                        <!-- Emotki bƒôdƒÖ ≈Çadowane dynamicznie -->
                    </div>
                    <textarea 
                        class="message-input" 
                        id="messageInput" 
                        placeholder="Napisz wiadomo≈õƒá..." 
                        rows="1"
                        oninput="autoResize(this)"
                    ></textarea>
                    <button class="send-button" id="sendMessageBtn" disabled>
                        Wy≈õlij
                    </button>
                </div>
            </div>
        </div>

        <!-- Panel u≈ºytkownik√≥w online -->
        <div class="users-sidebar" id="usersSidebar">
            <div class="users-title">U≈ªYTKOWNICY ONLINE ‚Äî <span id="onlineUsersCount">0</span></div>
            <div id="onlineUsersList">
                <!-- U≈ºytkownicy online bƒôdƒÖ ≈Çadowani dynamicznie -->
            </div>
        </div>
    </div>

    <!-- Modal tworzenia serwera -->
    <div class="modal-overlay" id="createServerModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Stw√≥rz serwer</h3>
                <p class="modal-subtitle">Stw√≥rz nowy serwer dla siebie i znajomych</p>
            </div>
            <input type="text" class="modal-input" id="serverNameInput" placeholder="Nazwa serwera">
            <textarea class="modal-input" id="serverDescriptionInput" placeholder="Opis serwera (opcjonalnie)" rows="3"></textarea>
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="cancelCreateServer">Anuluj</button>
                <button class="modal-btn primary" id="confirmCreateServer">Stw√≥rz</button>
            </div>
        </div>
    </div>

    <!-- Modal tworzenia kana≈Çu -->
    <div class="modal-overlay" id="createChannelModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Stw√≥rz kana≈Ç</h3>
                <p class="modal-subtitle">Dodaj nowy kana≈Ç na serwerze</p>
            </div>
            <input type="text" class="modal-input" id="channelNameInput" placeholder="Nazwa kana≈Çu">
            <textarea class="modal-input" id="channelTopicInput" placeholder="Temat kana≈Çu (opcjonalnie)" rows="3"></textarea>
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="cancelCreateChannel">Anuluj</button>
                <button class="modal-btn primary" id="confirmCreateChannel">Stw√≥rz</button>
            </div>
        </div>
    </div>

    <!-- Modal ustawie≈Ñ u≈ºytkownika -->
    <div class="modal-overlay" id="userSettingsModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Ustawienia konta</h3>
                <p class="modal-subtitle">ZarzƒÖdzaj swoim profilem</p>
            </div>
            <div class="modal-input" id="userSettingsInfo">
                <!-- Informacje o u≈ºytkowniku -->
            </div>
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="cancelUserSettings">Zamknij</button>
                <button class="modal-btn danger" id="logoutBtn">Wyloguj</button>
            </div>
        </div>
    </div>

    <!-- Modal ustawie≈Ñ serwera -->
    <div class="modal-overlay" id="serverSettingsModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Ustawienia serwera</h3>
                <p class="modal-subtitle" id="serverSettingsSubtitle">ZarzƒÖdzaj serwerem</p>
            </div>
            <input type="text" class="modal-input" id="serverSettingsName" placeholder="Nazwa serwera">
            <textarea class="modal-input" id="serverSettingsDescription" placeholder="Opis serwera" rows="3"></textarea>
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="cancelServerSettings">Anuluj</button>
                <button class="modal-btn primary" id="saveServerSettings">Zapisz</button>
            </div>
        </div>
    </div>

    <!-- Context menu -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" id="contextProfile">
            <i class="fas fa-user"></i>
            <span>Profil</span>
        </div>
        <div class="context-menu-item" id="contextMessage">
            <i class="fas fa-envelope"></i>
            <span>Wy≈õlij wiadomo≈õƒá</span>
        </div>
        <div class="context-menu-item" id="contextMakeAdmin">
            <i class="fas fa-crown"></i>
            <span>Mianuj adminem</span>
        </div>
        <div class="context-menu-item" id="contextKick">
            <i class="fas fa-sign-out-alt"></i>
            <span>Wyrzuƒá</span>
        </div>
        <div class="context-menu-item delete" id="contextBan">
            <i class="fas fa-ban"></i>
            <span>Zbanuj</span>
        </div>
    </div>

    <script>
        // Konfiguracja Firebase - WPISZ SWOJƒÑ KONFIGURACJƒò
        const firebaseConfig = {
            apiKey: "AIzaSyC7hMKirNQ9ltCU7AUWyJtf8fG9Y_EfPgQ",
            authDomain: "curl-1225d.firebaseapp.com",
            projectId: "curl-1225d",
            storageBucket: "curl-1225d.firebasestorage.app",
            messagingSenderId: "149369739586",
            appId: "1:149369739586:web:c3814530dc33b1e219d0db",
            measurementId: "G-3YQWJM1Y94"
        };

        // Inicjalizacja Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Zmienne globalne
        let currentUser = null;
        let currentServer = 'main'; // ID aktualnego serwera
        let currentChannel = null; // ID aktualnego kana≈Çu
        let unsubscribeMessages = null;
        let unsubscribeUsers = null;
        let unsubscribeServers = null;
        let unsubscribeChannels = null;
        
        // Dane admin√≥w - symulacja pliku admins.txt
        const adminData = {
            owners: ["1", "2", "3"], // ID w≈Ça≈õcicieli aplikacji
            admins: ["4", "5"], // ID admin√≥w aplikacji
            mods: ["6", "7", "8"] // ID moderator√≥w aplikacji
        };

        // Referencje do element√≥w DOM
        const loginOverlay = document.getElementById('loginOverlay');
        const serversSidebar = document.getElementById('serversSidebar');
        const mainContainer = document.getElementById('mainContainer');
        const googleLoginBtn = document.getElementById('googleLoginBtn');
        const discordLoginBtn = document.getElementById('discordLoginBtn');
        const messageInput = document.getElementById('messageInput');
        const sendMessageBtn = document.getElementById('sendMessageBtn');
        const messagesContainer = document.getElementById('messagesContainer');
        const onlineUsersList = document.getElementById('onlineUsersList');
        const onlineUsersCount = document.getElementById('onlineUsersCount');
        const friendsList = document.getElementById('friendsList');
        const onlineCount = document.getElementById('onlineCount');
        const userProfile = document.getElementById('userProfile');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const userTag = document.getElementById('userTag');
        const userBadge = document.getElementById('userBadge');
        const notificationArea = document.getElementById('notificationArea');
        const serverHeader = document.getElementById('serverHeader');
        const serverDropdown = document.getElementById('serverDropdown');
        const currentServerName = document.getElementById('currentServerName');
        const currentChannelName = document.getElementById('currentChannelName');
        const channelTopic = document.getElementById('channelTopic');
        const channelList = document.getElementById('channelList');
        const addServerBtn = document.getElementById('addServerBtn');
        const addChannelBtn = document.getElementById('addChannelBtn');
        const createServerModal = document.getElementById('createServerModal');
        const createChannelModal = document.getElementById('createChannelModal');
        const userSettingsModal = document.getElementById('userSettingsModal');
        const serverSettingsModal = document.getElementById('serverSettingsModal');
        const contextMenu = document.getElementById('contextMenu');
        const emojiBtn = document.getElementById('emojiBtn');
        const emojiPicker = document.getElementById('emojiPicker');
        const userSettingsBtn = document.getElementById('userSettingsBtn');
        const serverSettingsBtn = document.getElementById('serverSettingsBtn');
        const deleteServerBtn = document.getElementById('deleteServerBtn');
        const createChannelBtn = document.getElementById('createChannelBtn');

        // Emotki
        const emojis = ['üòÄ', 'üòÉ', 'üòÑ', 'üòÅ', 'üòÖ', 'üòÇ', 'ü§£', 'üòä', 'üòá', 'üôÇ', 'üôÉ', 'üòâ', 'üòå', 'üòç', 'ü•∞', 'üòò', 'üòó', 'üòô', 'üòö', 'üòã', 'üòõ', 'üòù', 'üòú', 'ü§™', 'ü§®', 'üßê', 'ü§ì', 'üòé', 'ü§©', 'ü•≥', 'üòè', 'üòí', 'üòû', 'üòî', 'üòü', 'üòï', 'üôÅ', '‚òπÔ∏è', 'üò£', 'üòñ', 'üò´', 'üò©', 'ü•∫', 'üò¢', 'üò≠', 'üò§', 'üò†', 'üò°', 'ü§¨', 'ü§Ø', 'üò≥', 'ü•µ', 'ü•∂', 'üò±', 'üò®', 'üò∞', 'üò•', 'üòì', 'ü§ó', 'ü§î', 'ü§≠', 'ü§´', 'ü§•', 'üò∂', 'üòê', 'üòë', 'üò¨', 'üôÑ', 'üòØ', 'üò¶', 'üòß', 'üòÆ', 'üò≤', 'ü•±', 'üò¥', 'ü§§', 'üò™', 'üòµ', 'ü§ê', 'ü•¥', 'ü§¢', 'ü§Æ', 'ü§ß', 'üò∑', 'ü§í', 'ü§ï', 'ü§ë', 'ü§†', 'üòà', 'üëø', 'üëπ', 'üë∫', 'ü§°', 'üí©', 'üëª', 'üíÄ', '‚ò†Ô∏è', 'üëΩ', 'üëæ', 'ü§ñ', 'üéÉ', 'üò∫', 'üò∏', 'üòπ', 'üòª', 'üòº', 'üòΩ', 'üôÄ', 'üòø', 'üòæ'];

        // Funkcja do wy≈õwietlania powiadomie≈Ñ
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            notificationArea.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 5000);
        }

        // Funkcja automatycznego resize textarea
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight) + 'px';
            sendMessageBtn.disabled = textarea.value.trim() === '';
        }

        // Funkcja sprawdzania uprawnie≈Ñ u≈ºytkownika
        function getUserRole(userId) {
            if (adminData.owners.includes(userId)) return 'owner';
            if (adminData.admins.includes(userId)) return 'admin';
            if (adminData.mods.includes(userId)) return 'mod';
            return 'user';
        }

        // Funkcja zwracajƒÖca badge dla roli
        function getRoleBadge(role) {
            switch(role) {
                case 'owner': return '<span class="friend-badge badge-owner">üëë W≈ÅA≈öCICIEL</span>';
                case 'admin': return '<span class="friend-badge badge-admin">ADMIN</span>';
                case 'mod': return '<span class="friend-badge badge-mod">MOD</span>';
                default: return '';
            }
        }

        // Funkcja zwracajƒÖca kolor dla roli
        function getRoleColor(role) {
            switch(role) {
                case 'owner': return '#faa81a';
                case 'admin': return '#ed4245';
                case 'mod': return '#5865f2';
                default: return '#5865f2';
            }
        }

        // Funkcja sprawdzajƒÖca czy u≈ºytkownik mo≈ºe usuwaƒá serwery
        function canDeleteServer(userId) {
            const role = getUserRole(userId);
            return role === 'owner' || role === 'admin';
        }

        // Funkcja do logowania przez Google
        function loginWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then((result) => {
                    showNotification('Zalogowano przez Google!', 'success');
                })
                .catch((error) => {
                    console.error('B≈ÇƒÖd logowania:', error);
                    showNotification(`B≈ÇƒÖd logowania: ${error.message}`, 'error');
                });
        }

        // Funkcja do logowania przez Discord (symulacja)
        function loginWithDiscord() {
            showNotification('Logowanie przez Discord - u≈ºyj Google', 'warning');
            loginWithGoogle();
        }

        // Funkcja do wysy≈Çania wiadomo≈õci
        function sendMessage() {
            const messageText = messageInput.value.trim();
            if (!messageText || !currentUser || !currentChannel) return;
            
            const messageData = {
                text: messageText,
                userId: currentUser.uid,
                userName: currentUser.displayName || 'Anonim',
                userAvatar: currentUser.photoURL || '',
                userRole: getUserRole(currentUser.uid),
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                serverId: currentServer,
                channelId: currentChannel
            };
            
            db.collection('messages').add(messageData)
                .then(() => {
                    messageInput.value = '';
                    messageInput.style.height = 'auto';
                    sendMessageBtn.disabled = true;
                })
                .catch((error) => {
                    console.error('B≈ÇƒÖd wysy≈Çania wiadomo≈õci:', error);
                    showNotification('Nie uda≈Ço siƒô wys≈Çaƒá wiadomo≈õci', 'error');
                });
        }

        // Funkcja do ≈Çadowania wiadomo≈õci
        function loadMessages(channelId) {
            if (unsubscribeMessages) unsubscribeMessages();
            
            currentChannel = channelId;
            unsubscribeMessages = db.collection('messages')
                .where('serverId', '==', currentServer)
                .where('channelId', '==', channelId)
                .orderBy('timestamp', 'asc')
                .limit(100)
                .onSnapshot((snapshot) => {
                    messagesContainer.innerHTML = '';
                    
                    if (snapshot.empty) {
                        const welcomeMessage = document.createElement('div');
                        welcomeMessage.className = 'message';
                        welcomeMessage.innerHTML = `
                            <div class="message-avatar" style="background-color: #3ba55d;">
                                <span>C</span>
                            </div>
                            <div class="message-content">
                                <div class="message-header">
                                    <span class="message-author">Curl</span>
                                    <span class="message-time">Dzisiaj</span>
                                </div>
                                <div class="message-text">
                                    Witaj na kanale! BƒÖd≈∫ pierwszy kt√≥ry napisze wiadomo≈õƒá.
                                </div>
                            </div>
                        `;
                        messagesContainer.appendChild(welcomeMessage);
                    }
                    
                    snapshot.forEach((doc) => {
                        const message = doc.data();
                        addMessageToDOM(message);
                    });
                    
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }, (error) => {
                    console.error('B≈ÇƒÖd ≈Çadowania wiadomo≈õci:', error);
                });
        }

        // Funkcja dodajƒÖca wiadomo≈õƒá do DOM
        function addMessageToDOM(message) {
            const messageElement = document.createElement('div');
            messageElement.className = 'message';
            
            // Formatowanie czasu
            let timeString = 'Przed chwilƒÖ';
            if (message.timestamp) {
                const date = message.timestamp.toDate();
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                
                if (diffMins < 1) {
                    timeString = 'Przed chwilƒÖ';
                } else if (diffMins < 60) {
                    timeString = `${diffMins} min temu`;
                } else {
                    timeString = date.toLocaleTimeString('pl-PL', {hour: '2-digit', minute:'2-digit'});
                }
            }
            
            // Kolor awatara
            const avatarColor = getRoleColor(message.userRole || 'user');
            
            messageElement.innerHTML = `
                <div class="message-avatar" style="background-color: ${avatarColor};" data-user-id="${message.userId}">
                    <span>${message.userName.charAt(0).toUpperCase()}</span>
                </div>
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-author">
                            ${message.userName}
                            ${getRoleBadge(message.userRole || 'user')}
                        </span>
                        <span class="message-time">${timeString}</span>
                    </div>
                    <div class="message-text">${message.text}</div>
                </div>
                <div class="message-actions">
                    ${canDeleteServer(currentUser.uid) ? '<button class="message-action-btn delete-message" data-message-id="${doc.id}">Usu≈Ñ</button>' : ''}
                </div>
            `;
            messagesContainer.appendChild(messageElement);
        }

        // Funkcja do ≈Çadowania serwer√≥w
        function loadServers() {
            if (unsubscribeServers) unsubscribeServers();
            
            unsubscribeServers = db.collection('servers')
                .onSnapshot((snapshot) => {
                    serversSidebar.innerHTML = '';
                    
                    // G≈Ç√≥wny serwer
                    const mainServer = document.createElement('div');
                    mainServer.className = 'server-icon curlio active';
                    mainServer.title = 'Curlio';
                    mainServer.dataset.serverId = 'main';
                    mainServer.innerHTML = 'C<div class="server-indicator"></div>';
                    mainServer.onclick = () => switchServer('main');
                    serversSidebar.appendChild(mainServer);
                    
                    const divider = document.createElement('div');
                    divider.className = 'divider';
                    serversSidebar.appendChild(divider);
                    
                    // Serwery z bazy
                    snapshot.forEach((doc) => {
                        const server = doc.data();
                        const serverElement = document.createElement('div');
                        serverElement.className = 'server-icon';
                        serverElement.title = server.name;
                        serverElement.dataset.serverId = doc.id;
                        serverElement.innerHTML = `${server.name.charAt(0).toUpperCase()}<div class="server-indicator"></div>`;
                        serverElement.onclick = () => switchServer(doc.id, server);
                        serversSidebar.appendChild(serverElement);
                    });
                    
                    // Przycisk dodawania serwera
                    const addServer = document.createElement('div');
                    addServer.className = 'server-icon add-server';
                    addServer.title = 'Dodaj serwer';
                    addServer.id = 'addServerBtn';
                    addServer.innerHTML = '<i class="fas fa-plus"></i>';
                    addServer.onclick = () => createServerModal.classList.remove('hidden');
                    serversSidebar.appendChild(addServer);
                }, (error) => {
                    console.error('B≈ÇƒÖd ≈Çadowania serwer√≥w:', error);
                });
        }

        // Funkcja do prze≈ÇƒÖczania serwera
        function switchServer(serverId, serverData = null) {
            currentServer = serverId;
            
            // Aktualizuj aktywne serwery
            document.querySelectorAll('.server-icon').forEach(icon => {
                icon.classList.remove('active');
                icon.querySelector('.server-indicator').style.height = '0';
            });
            
            const activeServer = document.querySelector(`[data-server-id="${serverId}"]`);
            if (activeServer) {
                activeServer.classList.add('active');
                activeServer.querySelector('.server-indicator').style.height = '20px';
            }
            
            // Ustaw nazwƒô serwera
            if (serverId === 'main') {
                currentServerName.textContent = 'Curlio';
                channelTopic.textContent = '‚Ä¢ Oficjalny serwer Curl';
            } else if (serverData) {
                currentServerName.textContent = serverData.name;
                channelTopic.textContent = serverData.description ? `‚Ä¢ ${serverData.description}` : '';
            }
            
            // Za≈Çaduj kana≈Çy dla serwera
            loadChannels(serverId);
            
            // Za≈Çaduj cz≈Çonk√≥w serwera
            loadServerMembers(serverId);
        }

        // Funkcja do ≈Çadowania kana≈Ç√≥w
        function loadChannels(serverId) {
            if (unsubscribeChannels) unsubscribeChannels();
            
            channelList.innerHTML = '';
            
            unsubscribeChannels = db.collection('channels')
                .where('serverId', '==', serverId)
                .orderBy('createdAt', 'asc')
                .onSnapshot((snapshot) => {
                    channelList.innerHTML = '';
                    
                    // Domy≈õlny kana≈Ç dla g≈Ç√≥wnego serwera
                    if (serverId === 'main' && snapshot.empty) {
                        const defaultChannel = document.createElement('div');
                        defaultChannel.className = 'channel-item active';
                        defaultChannel.dataset.channelId = 'general';
                        defaultChannel.innerHTML = `
                            <i class="fas fa-hashtag channel-icon"></i>
                            <span>og√≥lny</span>
                        `;
                        defaultChannel.onclick = () => {
                            document.querySelectorAll('.channel-item').forEach(item => {
                                item.classList.remove('active');
                            });
                            defaultChannel.classList.add('active');
                            currentChannelName.textContent = 'og√≥lny';
                            loadMessages('general');
                        };
                        channelList.appendChild(defaultChannel);
                        
                        // Za≈Çaduj wiadomo≈õci dla domy≈õlnego kana≈Çu
                        loadMessages('general');
                        currentChannelName.textContent = 'og√≥lny';
                    }
                    
                    snapshot.forEach((doc) => {
                        const channel = doc.data();
                        const channelElement = document.createElement('div');
                        channelElement.className = 'channel-item';
                        if (snapshot.docs[0].id === doc.id) {
                            channelElement.classList.add('active');
                            loadMessages(doc.id);
                            currentChannelName.textContent = channel.name;
                        }
                        channelElement.dataset.channelId = doc.id;
                        channelElement.innerHTML = `
                            <i class="fas fa-hashtag channel-icon"></i>
                            <span>${channel.name}</span>
                            <div class="channel-settings">
                                <i class="fas fa-cog" style="font-size: 12px;"></i>
                            </div>
                        `;
                        channelElement.onclick = () => {
                            document.querySelectorAll('.channel-item').forEach(item => {
                                item.classList.remove('active');
                            });
                            channelElement.classList.add('active');
                            currentChannelName.textContent = channel.name;
                            loadMessages(doc.id);
                        };
                        channelList.appendChild(channelElement);
                    });
                }, (error) => {
                    console.error('B≈ÇƒÖd ≈Çadowania kana≈Ç√≥w:', error);
                });
        }

        // Funkcja do ≈Çadowania cz≈Çonk√≥w serwera
        function loadServerMembers(serverId) {
            // ≈öledzenie aktywnych u≈ºytkownik√≥w
            if (unsubscribeUsers) unsubscribeUsers();
            
            unsubscribeUsers = db.collection('status')
                .where('state', '==', 'online')
                .onSnapshot((snapshot) => {
                    friendsList.innerHTML = '';
                    onlineUsersList.innerHTML = '';
                    let onlineCountNum = 0;
                    
                    // Dodaj systemowego u≈ºytkownika
                    const systemUser = document.createElement('div');
                    systemUser.className = 'user-item';
                    systemUser.innerHTML = `
                        <div class="user-avatar" style="background-color: #5865f2;">
                            <span>C</span>
                            <div class="status-indicator status-online"></div>
                        </div>
                        <div class="user-info">
                            <div class="user-name">Curl</div>
                            <div class="user-activity">System</div>
                        </div>
                    `;
                    onlineUsersList.appendChild(systemUser);
                    onlineCountNum++;
                    
                    // Dodaj zalogowanych u≈ºytkownik√≥w
                    snapshot.forEach((doc) => {
                        const userData = doc.data();
                        onlineCountNum++;
                        
                        // Dodaj do listy znajomych
                        const friendItem = document.createElement('div');
                        friendItem.className = 'friend-item';
                        friendItem.dataset.userId = userData.userId;
                        
                        const userRole = getUserRole(userData.userId);
                        const avatarColor = getRoleColor(userRole);
                        
                        friendItem.innerHTML = `
                            <div class="friend-avatar" style="background-color: ${avatarColor};">
                                <span>${userData.userName.charAt(0).toUpperCase()}</span>
                                <div class="status-indicator status-online"></div>
                            </div>
                            <div class="friend-info">
                                <div class="friend-name">
                                    ${userData.userName}
                                    ${getRoleBadge(userRole)}
                                </div>
                                <div class="friend-status">Online</div>
                            </div>
                            <div class="friend-actions">
                                <i class="fas fa-envelope"></i>
                            </div>
                        `;
                        friendsList.appendChild(friendItem);
                        
                        // Dodaj do listy online
                        const userItem = document.createElement('div');
                        userItem.className = 'user-item';
                        userItem.dataset.userId = userData.userId;
                        userItem.innerHTML = `
                            <div class="user-avatar" style="background-color: ${avatarColor};">
                                <span>${userData.userName.charAt(0).toUpperCase()}</span>
                                <div class="status-indicator status-online"></div>
                            </div>
                            <div class="user-info">
                                <div class="user-name">
                                    ${userData.userName}
                                    ${getRoleBadge(userRole)}
                                </div>
                                <div class="user-activity">Na Curl</div>
                            </div>
                        `;
                        onlineUsersList.appendChild(userItem);
                    });
                    
                    onlineUsersCount.textContent = onlineCountNum;
                    onlineCount.textContent = onlineCountNum;
                });
        }

        // Funkcja do aktualizacji profilu u≈ºytkownika
        function updateUserProfile(user) {
            const displayName = user.displayName || 'U≈ºytkownik';
            const photoURL = user.photoURL;
            const initials = displayName.charAt(0).toUpperCase();
            const userRole = getUserRole(user.uid);
            
            userName.innerHTML = `
                <span>${displayName}</span>
                ${getRoleBadge(userRole)}
            `;
            userTag.textContent = `#${user.uid.substring(0, 4)}`;
            
            if (photoURL) {
                userAvatar.style.backgroundImage = `url(${photoURL})`;
                userAvatar.style.backgroundSize = 'cover';
                userAvatar.innerHTML = '';
            } else {
                userAvatar.style.backgroundImage = '';
                userAvatar.innerHTML = `<span>${initials}</span>`;
                userAvatar.style.backgroundColor = getRoleColor(userRole);
            }
        }

        // Funkcja do tworzenia serwera
        function createServer() {
            const name = document.getElementById('serverNameInput').value.trim();
            const description = document.getElementById('serverDescriptionInput').value.trim();
            
            if (!name) {
                showNotification('Wpisz nazwƒô serwera', 'warning');
                return;
            }
            
            const serverData = {
                name: name,
                description: description,
                ownerId: currentUser.uid,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                members: [currentUser.uid]
            };
            
            db.collection('servers').add(serverData)
                .then((docRef) => {
                    // Stw√≥rz domy≈õlny kana≈Ç
                    db.collection('channels').add({
                        name: 'og√≥lny',
                        serverId: docRef.id,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    createServerModal.classList.add('hidden');
                    document.getElementById('serverNameInput').value = '';
                    document.getElementById('serverDescriptionInput').value = '';
                    showNotification('Serwer zosta≈Ç stworzony!', 'success');
                })
                .catch((error) => {
                    console.error('B≈ÇƒÖd tworzenia serwera:', error);
                    showNotification('Nie uda≈Ço siƒô stworzyƒá serwera', 'error');
                });
        }

        // Funkcja do tworzenia kana≈Çu
        function createChannel() {
            const name = document.getElementById('channelNameInput').value.trim();
            const topic = document.getElementById('channelTopicInput').value.trim();
            
            if (!name) {
                showNotification('Wpisz nazwƒô kana≈Çu', 'warning');
                return;
            }
            
            const channelData = {
                name: name,
                topic: topic,
                serverId: currentServer,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                createdBy: currentUser.uid
            };
            
            db.collection('channels').add(channelData)
                .then(() => {
                    createChannelModal.classList.add('hidden');
                    document.getElementById('channelNameInput').value = '';
                    document.getElementById('channelTopicInput').value = '';
                    showNotification('Kana≈Ç zosta≈Ç stworzony!', 'success');
                })
                .catch((error) => {
                    console.error('B≈ÇƒÖd tworzenia kana≈Çu:', error);
                    showNotification('Nie uda≈Ço siƒô stworzyƒá kana≈Çu', 'error');
                });
        }

        // Funkcja do usuwania serwera
        function deleteServer() {
            if (currentServer === 'main') {
                showNotification('Nie mo≈ºna usunƒÖƒá g≈Ç√≥wnego serwera', 'error');
                return;
            }
            
            if (!canDeleteServer(currentUser.uid)) {
                showNotification('Nie masz uprawnie≈Ñ do usuwania serwer√≥w', 'error');
                return;
            }
            
            if (confirm('Czy na pewno chcesz usunƒÖƒá ten serwer? Ta operacja jest nieodwracalna.')) {
                db.collection('servers').doc(currentServer).delete()
                    .then(() => {
                        // Usu≈Ñ wszystkie kana≈Çy tego serwera
                        db.collection('channels').where('serverId', '==', currentServer).get()
                            .then((snapshot) => {
                                const batch = db.batch();
                                snapshot.forEach((doc) => {
                                    batch.delete(doc.ref);
                                });
                                return batch.commit();
                            });
                        
                        // Usu≈Ñ wszystkie wiadomo≈õci z tego serwera
                        db.collection('messages').where('serverId', '==', currentServer).get()
                            .then((snapshot) => {
                                const batch = db.batch();
                                snapshot.forEach((doc) => {
                                    batch.delete(doc.ref);
                                });
                                return batch.commit();
                            });
                        
                        // Prze≈ÇƒÖcz na g≈Ç√≥wny serwer
                        switchServer('main');
                        showNotification('Serwer zosta≈Ç usuniƒôty', 'success');
                    })
                    .catch((error) => {
                        console.error('B≈ÇƒÖd usuwania serwera:', error);
                        showNotification('Nie uda≈Ço siƒô usunƒÖƒá serwera', 'error');
                    });
            }
        }

        // Funkcja do wylogowania
        function logout() {
            // Ustaw status offline
            if (currentUser) {
                db.collection('status').doc(currentUser.uid).set({
                    state: 'offline',
                    lastChanged: firebase.firestore.FieldValue.serverTimestamp(),
                    userId: currentUser.uid,
                    userName: currentUser.displayName || 'U≈ºytkownik'
                });
            }
            
            auth.signOut()
                .then(() => {
                    showNotification('Wylogowano pomy≈õlnie', 'info');
                })
                .catch((error) => {
                    console.error('B≈ÇƒÖd wylogowania:', error);
                });
        }

        // Obs≈Çuga stanu uwierzytelnienia
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                updateUserProfile(user);
                
                // Zapisz u≈ºytkownika w Firestore
                db.collection('users').doc(user.uid).set({
                    uid: user.uid,
                    displayName: user.displayName || 'U≈ºytkownik',
                    email: user.email,
                    photoURL: user.photoURL || '',
                    role: getUserRole(user.uid),
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
                
                // Ustaw status online
                db.collection('status').doc(user.uid).set({
                    state: 'online',
                    lastChanged: firebase.firestore.FieldValue.serverTimestamp(),
                    userId: user.uid,
                    userName: user.displayName || 'U≈ºytkownik',
                    userAvatar: user.photoURL || ''
                });
                
                // Prze≈ÇƒÖcz widok
                loginOverlay.classList.add('hidden');
                serversSidebar.classList.remove('hidden');
                mainContainer.classList.remove('hidden');
                
                // Za≈Çaduj dane
                loadServers();
                switchServer('main');
                
                // Dodaj admin√≥w do bazy je≈õli nie istniejƒÖ
                const addAdminIfNotExists = (adminId, name) => {
                    db.collection('users').doc(adminId).get().then(doc => {
                        if (!doc.exists) {
                            db.collection('users').doc(adminId).set({
                                uid: adminId,
                                displayName: name,
                                role: getUserRole(adminId),
                                createdAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }
                    });
                };
                
                // Dodaj przyk≈Çadowych admin√≥w
                addAdminIfNotExists('1', 'W≈Ça≈õciciel üëë');
                addAdminIfNotExists('2', 'Admin 1');
                addAdminIfNotExists('3', 'Admin 2');
                addAdminIfNotExists('4', 'Moderator 1');
                addAdminIfNotExists('5', 'Moderator 2');
                
                showNotification(`Witaj, ${user.displayName || 'U≈ºytkowniku'}!`, 'success');
            } else {
                currentUser = null;
                if (unsubscribeMessages) unsubscribeMessages();
                if (unsubscribeUsers) unsubscribeUsers();
                if (unsubscribeServers) unsubscribeServers();
                if (unsubscribeChannels) unsubscribeChannels();
                
                loginOverlay.classList.remove('hidden');
                serversSidebar.classList.add('hidden');
                mainContainer.classList.add('hidden');
                messageInput.value = '';
                sendMessageBtn.disabled = true;
            }
        });

        // Inicjalizacja emoji pickera
        emojis.forEach(emoji => {
            const emojiItem = document.createElement('div');
            emojiItem.className = 'emoji-item';
            emojiItem.textContent = emoji;
            emojiItem.onclick = () => {
                messageInput.value += emoji;
                messageInput.focus();
                autoResize(messageInput);
            };
            emojiPicker.appendChild(emojiItem);
        });

        // Event Listeners
        googleLoginBtn.addEventListener('click', loginWithGoogle);
        discordLoginBtn.addEventListener('click', loginWithDiscord);
        
        sendMessageBtn.addEventListener('click', sendMessage);
        
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        emojiBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            emojiPicker.style.display = emojiPicker.style.display === 'grid' ? 'none' : 'grid';
        });

        document.addEventListener('click', () => {
            emojiPicker.style.display = 'none';
            serverDropdown.style.display = 'none';
            contextMenu.style.display = 'none';
        });

        serverHeader.addEventListener('click', (e) => {
            e.stopPropagation();
            const rect = serverHeader.getBoundingClientRect();
            serverDropdown.style.left = '240px';
            serverDropdown.style.top = `${rect.bottom}px`;
            serverDropdown.style.display = 'block';
        });

        userSettingsBtn.addEventListener('click', () => {
            userSettingsModal.classList.remove('hidden');
            document.getElementById('userSettingsInfo').innerHTML = `
                <strong>ID u≈ºytkownika:</strong> ${currentUser.uid}<br>
                <strong>Email:</strong> ${currentUser.email || 'Brak'}<br>
                <strong>Rola:</strong> ${getUserRole(currentUser.uid).toUpperCase()}<br>
                <strong>Data utworzenia:</strong> ${new Date().toLocaleDateString('pl-PL')}
            `;
        });

        serverSettingsBtn.addEventListener('click', () => {
            if (currentServer === 'main') {
                showNotification('Nie mo≈ºna edytowaƒá g≈Ç√≥wnego serwera', 'warning');
                return;
            }
            
            db.collection('servers').doc(currentServer).get().then(doc => {
                if (doc.exists) {
                    const server = doc.data();
                    document.getElementById('serverSettingsName').value = server.name;
                    document.getElementById('serverSettingsDescription').value = server.description || '';
                    document.getElementById('serverSettingsSubtitle').textContent = `ID: ${currentServer}`;
                    serverSettingsModal.classList.remove('hidden');
                }
            });
        });

        deleteServerBtn.addEventListener('click', deleteServer);
        
        createChannelBtn.addEventListener('click', () => {
            createChannelModal.classList.remove('hidden');
        });

        addServerBtn.addEventListener('click', () => {
            createServerModal.classList.remove('hidden');
        });

        addChannelBtn.addEventListener('click', () => {
            createChannelModal.classList.remove('hidden');
        });

        // Modal buttons
        document.getElementById('cancelCreateServer').addEventListener('click', () => {
            createServerModal.classList.add('hidden');
        });

        document.getElementById('confirmCreateServer').addEventListener('click', createServer);

        document.getElementById('cancelCreateChannel').addEventListener('click', () => {
            createChannelModal.classList.add('hidden');
        });

        document.getElementById('confirmCreateChannel').addEventListener('click', createChannel);

        document.getElementById('cancelUserSettings').addEventListener('click', () => {
            userSettingsModal.classList.add('hidden');
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
            userSettingsModal.classList.add('hidden');
            logout();
        });

        document.getElementById('cancelServerSettings').addEventListener('click', () => {
            serverSettingsModal.classList.add('hidden');
        });

        document.getElementById('saveServerSettings').addEventListener('click', () => {
            const name = document.getElementById('serverSettingsName').value.trim();
            const description = document.getElementById('serverSettingsDescription').value.trim();
            
            if (!name) {
                showNotification('Nazwa serwera nie mo≈ºe byƒá pusta', 'warning');
                return;
            }
            
            db.collection('servers').doc(currentServer).update({
                name: name,
                description: description
            }).then(() => {
                serverSettingsModal.classList.add('hidden');
                currentServerName.textContent = name;
                showNotification('Ustawienia serwera zapisane', 'success');
            }).catch(error => {
                console.error('B≈ÇƒÖd aktualizacji serwera:', error);
                showNotification('Nie uda≈Ço siƒô zapisaƒá ustawie≈Ñ', 'error');
            });
        });

        // Context menu
        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            
            const userItem = e.target.closest('[data-user-id]');
            if (userItem) {
                const userId = userItem.dataset.userId;
                const currentUserRole = getUserRole(currentUser.uid);
                const targetUserRole = getUserRole(userId);
                
                // Ukryj opcje kt√≥rych u≈ºytkownik nie mo≈ºe u≈ºywaƒá
                document.getElementById('contextMakeAdmin').style.display = 
                    (currentUserRole === 'owner' && targetUserRole !== 'owner') ? 'flex' : 'none';
                document.getElementById('contextKick').style.display = 
                    (currentUserRole === 'owner' || currentUserRole === 'admin') ? 'flex' : 'none';
                document.getElementById('contextBan').style.display = 
                    (currentUserRole === 'owner' || currentUserRole === 'admin') ? 'flex' : 'none';
                
                contextMenu.style.left = `${e.pageX}px`;
                contextMenu.style.top = `${e.pageY}px`;
                contextMenu.style.display = 'block';
                contextMenu.dataset.targetUserId = userId;
            }
        });

        // Context menu actions
        document.getElementById('contextProfile').addEventListener('click', () => {
            const userId = contextMenu.dataset.targetUserId;
            showNotification(`Profil u≈ºytkownika: ${userId}`, 'info');
            contextMenu.style.display = 'none';
        });

        document.getElementById('contextMessage').addEventListener('click', () => {
            const userId = contextMenu.dataset.targetUserId;
            messageInput.value = `@${userId} `;
            messageInput.focus();
            contextMenu.style.display = 'none';
        });

        document.getElementById('contextMakeAdmin').addEventListener('click', () => {
            const userId = contextMenu.dataset.targetUserId;
            if (confirm(`Czy na pewno chcesz mianowaƒá u≈ºytkownika ${userId} adminem?`)) {
                showNotification(`U≈ºytkownik ${userId} zosta≈Ç mianowany adminem`, 'success');
                contextMenu.style.display = 'none';
            }
        });

        document.getElementById('contextKick').addEventListener('click', () => {
            const userId = contextMenu.dataset.targetUserId;
            if (confirm(`Czy na pewno chcesz wyrzuciƒá u≈ºytkownika ${userId}?`)) {
                showNotification(`U≈ºytkownik ${userId} zosta≈Ç wyrzucony`, 'success');
                contextMenu.style.display = 'none';
            }
        });

        document.getElementById('contextBan').addEventListener('click', () => {
            const userId = contextMenu.dataset.targetUserId;
            if (confirm(`Czy na pewno chcesz zbanowaƒá u≈ºytkownika ${userId}?`)) {
                showNotification(`U≈ºytkownik ${userId} zosta≈Ç zbanowany`, 'success');
                contextMenu.style.display = 'none';
            }
        });

        // Enter do wysy≈Çania w modalach
        document.getElementById('serverNameInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') createServer();
        });

        document.getElementById('channelNameInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') createChannel();
        });

        // Inicjalizacja
        console.log('Curl - Platforma komunikacyjna');
        console.log('Admini:', adminData);
    </script>
</body>
</html>
